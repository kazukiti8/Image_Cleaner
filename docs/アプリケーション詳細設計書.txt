--- START OF FILE アプリケーション詳細設計書.txt ---
画像整理アプリ アプリケーション詳細設計書 v1.0

このドキュメントは、画像整理アプリのインタラクション定義と状態管理・永続化に関する詳細設計をまとめたものです。

**目次**
1. 詳細インタラクション定義 (旧 `詳細インタラクション定義.txt` より)
    1.1. ドラッグ＆ドロップ操作
    1.2. キーボードショートカット
    1.3. リスト操作（マウス）
    1.4. ツールチップ表示
    1.5. その他 (プレビューエリアの倍率調整、メイン3ペインの幅調整など)
2. 状態管理・永続化定義 (旧 `状態管理・永続化定義.txt` より)
    2.1. 基本方針
    2.2. 永続化する情報と詳細
    2.3. 永続化しない情報（セッション中のみ保持）

---
**1. 詳細インタラクション定義**
(旧 `詳細インタラクション定義.txt` v1.4 (最終FIX版) より)
---

1.1. ドラッグ＆ドロップ操作
1.1.1. 対象フォルダ指定時のドラッグ＆ドロップ
ドラッグオーバー時のUIフィードバック :
対象: アプリケーションウィンドウ全体、またはヘッダーの「対象フォルダ選択」エリア。
フィードバック:
ウィンドウ枠または対象エリアの境界線が太くなる、またはアクセントカラー（例: プライマリーカラーのブルー系）でハイライトされる。
ドロップ可能なアイコン（ Google Fonts Icon folder_open_outline (Outlined) ）や「フォルダをここにドロップ」のようなテキストがオーバーレイ表示される。
マウスカーソルが「コピー」や「リンク」のような形状に変化する（OS標準の挙動に依存する場合あり）。
ドロップ実行時の処理 :
ドロップされたアイテムが単一のフォルダである場合:
ヘッダーの「対象フォルダ選択」エリアにフォルダパスが表示される。
フォルダ選択ダイアログで選択された場合と同様の内部処理を実行する。
ドロップされたアイテムがファイル、または複数のフォルダ/ファイルである場合:
エラーフィードバック: 「フォルダを1つだけドロップしてください」のようなメッセージをトースト通知またはステータスバーに表示する。
パス表示エリアは変更しない。
ドロップキャンセル時（エリア外でのドロップなど） :
ドラッグオーバー時のUIフィードバックは解除される。

1.1.2. 移動先フォルダ指定時のドラッグ＆ドロップ
ドラッグオーバー時のUIフィードバック :
対象: ヘッダーの「移動先フォルダ選択」エリア。
フィードバック:
対象エリアの境界線が太くなる、またはアクセントカラーでハイライトされる。
「移動先フォルダをここにドロップ」のようなテキストと、必要であればフォルダアイコン（ Google Fonts Icon folder_open_outline (Outlined) ）がオーバーレイ表示される。
ドロップ実行時の処理 :
ドロップされたアイテムが単一のフォルダである場合:
ヘッダーの「移動先フォルダ選択」エリアにフォルダパスが表示される。
ドロップされたアイテムがファイル、または複数のフォルダ/ファイルである場合:
エラーフィードバック: 「フォルダを1つだけドロップしてください」のようなメッセージをトースト通知またはステータスバーに表示する。
パス表示エリアは変更しない。
ドロップキャンセル時 :
ドラッグオーバー時のUIフィードバックは解除される。

1.2. キーボードショートカット
1.2.1. グローバルショートカット（アプリ全体で有効）
設定画面を開く: Ctrl+, (カンマ)
アプリケーション終了: Alt+F4 (Windows標準)

1.2.2. メイン画面操作
タブ切り替え :
次のタブへ: Ctrl+Tab または Ctrl+PageDown
前のタブへ: Ctrl+Shift+Tab または Ctrl+PageUp
ブレ画像タブへ: Ctrl+1
類似画像タブへ: Ctrl+2
エラータブへ: Ctrl+3
スキャン開始/キャンセル :
スキャン開始: F5 または Ctrl+R (「スキャン開始」ボタンにフォーカスがある場合は Enter または Space )
スキャンキャンセル : スキャン中にヘッダーの「スキャン開始」ボタンが「スキャン中...(キャンセル)」に変化し、そのボタンにフォーカスがある場合は Enter または Space 。クリック時には確認ダイアログを表示し、ユーザーの意思確認後に処理を中止する。
対象フォルダ選択ダイアログを開く: Ctrl+O
移動先フォルダ選択ダイアログを開く: Ctrl+Shift+O

1.2.3. リスト操作（中央ペインのリストにフォーカスがある場合）
仮想スクロールライブラリとして Clusterize.js を使用することを想定。キーボード操作のアクセシビリティについては、ライブラリの標準機能に加え、必要に応じて追加実装を検討する。
アイテム選択 :
上下移動: ↑ (上矢印キー), ↓ (下矢印キー) でリスト内のフォーカス（または仮想的な選択行）を移動。
単一選択 (チェックボックスのON/OFF) : Space キー（フォーカスされている行のチェックボックスの状態をトグル）。
範囲選択の起点: (Shiftキーを押しながらの移動は標準的な挙動に準ずる。Shift + ↑/↓ で連続選択)
複数選択 (Ctrlキー併用): Ctrl + ↑ / ↓ でフォーカス移動後、 Space キー で選択/解除。
全選択: Ctrl+A (現在表示されているタブのリスト内全アイテムを選択)
選択解除 (現在チェックされている全アイテムのチェックをOFFにする) : Ctrl+D
プレビュー表示: Enter (選択中またはフォーカスされているアイテムを左ペインにプレビュー)
コンテキストメニュー表示: Shift+F10 または アプリケーションキー

1.2.4. アクションボタン（フッター）
各アクションボタン（「選択した画像をゴミ箱へ」など）にフォーカスがある場合: Enter または Space で実行。実行前に確認ダイアログを表示する。

1.2.5. フィルター操作（右ペイン）
フィルター適用: (「適用」ボタンにフォーカスがある場合) Enter
フィルターリセット: (「リセット」ボタンにフォーカスがある場合) Enter
フォーカス移動: Tab キー、 Shift+Tab キー

1.2.6. プレビュー倍率操作（左ペインのプレビューエリアにフォーカス、または操作UIにフォーカスがある場合）
拡大: Ctrl + + (プラスキー) (対応アイコン: Google Fonts Icon add_circle_outline (Outlined) )
縮小: Ctrl + - (マイナスキー) (対応アイコン: Google Fonts Icon remove_circle_outline (Outlined) )
100%表示: Ctrl + 0 (数字のゼロ) (対応アイコン: Google Fonts Icon filter_center_focus (Outlined) )

1.3. リスト操作（マウス）
1.3.1. 選択
単一選択: 行クリックで当該行を選択状態にし、他の選択は解除。チェックボックスクリックで当該行の選択状態をトグル。
複数選択 (Ctrlキー): Ctrlキーを押しながら行クリックで、クリックした行の選択状態をトグル（他の行の選択状態は維持）。
範囲選択 (Shiftキー): 最後にクリックした行を起点とし、Shiftキーを押しながら別の行をクリックすると、その間の全ての行を選択状態にする。
ドラッグによる範囲選択 : v1.0では実装しない。
類似画像リストのチェックボックス操作 :
ペア選択チェック : 行の先頭に配置。ONにするとそのペアが操作のスコープに含まれる。OFFならスコープ外。デフォルトOFF。
ファイル1選択チェック / ファイル2選択チェック : 各画像の横に配置。個々の画像を操作対象とするかを示す。アプリ推奨に基づき、推奨されなかった方の画像のファイル選択チェックボックスをデフォルトでオンにする。
操作対象の決定 : フッターのアクションボタンによる操作対象は、「ペア選択チェック」がONであり、かつそのペア内の「ファイル1選択チェック」または「ファイル2選択チェック」の少なくとも一方がONである画像となる。

1.3.2. ソート
初期ソート状態: 各タブのリストが表示される際、前回終了時にそのタブで設定されていたソート条件（カラム、昇順/降順）を復元する。永続化された情報がない場合は、各タブであらかじめ定義されたデフォルトのソート順（例：ブレ画像タブはブレスコア降順、類似画像タブは類似度降順、エラータブはファイル名昇順）を適用する。
カラムヘッダーのクリック時の動作:
現在ソート対象でないカラムのヘッダーをクリックすると、そのカラムを昇順でリストを並べ替える。
現在「昇順」でソートされているカラムのヘッダーを再度クリックすると、降順でリストを並べ替える。
現在「降順」でソートされているカラムのヘッダーを再度クリックすると、昇順でリストを並べ替える（昇順⇔降順のトグル）。
視覚的フィードバック: ソートが適用されているカラムヘッダーは、カラム名テキストを太字またはアクセントカラー（例：ブルー系）で表示する。昇順ソート時はカラム名の右に Google Fonts Icon arrow_upward (Outlined) アイコン、降順ソート時は Google Fonts Icon arrow_downward (Outlined) アイコンを表示する。ソートが適用されていない他のカラムヘッダーは通常表示とし、アイコンは表示しない。

1.3.3. コンテキストメニュー
リストアイテムを右クリックすると、コンテキストメニューを表示。
メニュー項目例 (ブレ画像/類似画像タブ):
選択した画像をゴミ箱へ
選択した画像を完全に削除
選択した画像を移動...
ファイルのある場所を開く
プロパティ
メニュー項目例 (エラータブ):
選択を無視
再スキャン試行 (アイコン: replay_circle_filled)
ファイルのある場所を開く
エラー内容をコピー
(注意: 「選択をリストから削除」は仕様変更により削除)

1.4. ツールチップ表示
対象と表示内容:
省略されたパス名: ヘッダーの「対象フォルダ」「移動先フォルダ」パスが省略表示されている場合、マウスオーバーでフルパスをツールチップ表示。
アイコンのみのボタン: ヘッダーの「設定」ボタン（ Google Fonts Icon settings (Outlined) を使用）など、アイコンのみでラベルがないボタンは、マウスオーバーで機能名（例: 「設定」）をツールチップ表示。
リスト内の省略されたファイル名/パス名: 表示幅の都合で省略表示されている場合、マウスオーバーで全文をツールチップ表示。
ブレ画像リストの「ブレスコア」カラムヘッダー: マウスオーバーで「ブレの度合い (0-100、数値が高いほどブレが大きい)」の説明をツールチップ表示。各スコア値にはツールチップを付けない。
類似画像リストの「類似度」カラムヘッダー: マウスオーバーで「画像の類似度 (0-100%、数値が高いほど類似している)」の説明をツールチップ表示。各類似度にはツールチップを付けない。
類似画像リストの推奨アイコン (星: star_outline , 王冠: workspace_premium ): マウスオーバーで「アプリによる推奨（主な判断根拠: 解像度が高い）」をツールチップ表示。
無効化されたボタン: なぜ無効化されているかの理由をツールチップで表示。具体的な文言は以下の通り。
ヘッダー「スキャン開始」ボタン無効時:
対象フォルダ未選択: 「スキャン対象のフォルダを選択してください。」
スキャン実行中: 「現在スキャンを実行中です。」
フッター「ゴミ箱へ」「完全に削除」「移動...」ボタン無効時 (ブレ/類似タブ):
アイテム未選択: 「整理する画像を選択してください。」
（移動ボタンのみ）移動先フォルダ未選択: 「移動先のフォルダを選択してください。」
フッター「選択を無視」「再スキャン試行」ボタン無効時 (エラータブ):
アイテム未選択: 「操作対象のエラー項目を選択してください。」
右ペイン フィルター「適用」ボタン無効時:
条件変更なし: 「適用するフィルター条件の変更がありません。」
条件無効: 「有効なフィルター条件を入力してください。」
右ペイン フィルター「リセット」ボタン無効時:
初期状態: 「フィルターは既に初期状態です。」
右ペイン「エラーログをエクスポート...」ボタン無効時:
エラー0件: 「エクスポート対象のエラーがありません。」
表示タイミング: マウスカーソルが対象要素上に一定時間（例: 0.5秒〜1秒）留まった場合に表示。
表示時間: マウスカーソルが要素上にある間は表示し続け、要素外に移動したら非表示。

1.5. その他
1.5.1. プレビューエリアの倍率調整 (ブレ画像・類似画像共通)
ブレ画像プレビュー、類似画像プレビュー（2画面表示）のいずれにおいても、プレビューエリア下部に共通の倍率調整UIを配置する。
UIコンポーネント: スライダー(1%-150%)、数値入力フィールド、拡大ボタン(add_circle_outline)、縮小ボタン(remove_circle_outline)、100%リセットボタン(filter_center_focus)。
動作: 2つの類似画像プレビューは、常に同じ倍率で連動して拡大・縮小される。
キーボードショートカット: Ctrl + + (拡大), Ctrl + - (縮小), Ctrl + 0 (100%リセット)。
マウスホイール: Ctrlキー + マウスホイールで拡大縮小（プレビューエリアにフォーカスがある場合）。

1.5.2. メイン3ペインの幅調整
ペイン間の境界線をドラッグすることで、各ペインの幅をユーザーが調整可能にする。
調整した幅はセッション中（または永続的に）記憶する。
最小幅を設定し、それ以下にはならないようにする。

1.5.3. リストアイテムのホバーエフェクト
全てのリストアイテム（ブレ画像、類似画像、エラー）の各行に対して、共通のホバーエフェクト（例: hover:bg-slate-100）を適用する。
現在選択されている行のハイライト（例: bg-sky-50）とは明確に区別できる色にする。
類似画像リストの推奨ペア行のホバーエフェクト（例: hover:bg-yellow-100）は、そのままで特別感を出す。

1.5.4. 初回起動時ガイダンスのインタラクション
モーダルダイアログ:
各ステップで説明対象のUI要素以外を半透明の暗いオーバーレイで覆う（スポットライト効果）。
ナビゲーションボタン（「次へ」 arrow_forward_ios、「スキップ」 skip_next、「開始する」 rocket_launch、「閉じる」 check_circle_outline）をクリックすると、次のステップへ進むか、ガイダンスを終了する。
導入メッセージ時に表示される「□ 次回からこのガイダンスを表示しない」チェックボックスのON/OFF状態は、ガイダンス終了時に永続化される。

1.5.5. 確認ダイアログのインタラクション（削除・移動操作時）
表示: フッターの「ゴミ箱へ」「完全に削除」「移動...」ボタン押下時に、対応する確認モーダルダイアログを表示する。
実行ボタン: 各ダイアログの「ゴミ箱へ移動」「完全に削除」「移動する」ボタンをクリックすると、対応するファイル操作を実行し、ダイアログを閉じる。
キャンセルボタン: 「キャンセル」ボタンをクリックすると、ファイル操作は実行せず、ダイアログを閉じる。

---
**2. 状態管理・永続化定義**
(旧 `状態管理・永続化定義.txt` v1.1 (最終FIX版) より)
---

2.1. 基本方針
目的: ユーザーがアプリケーションをより快適に、継続的に利用できるようにするため、適切な情報を永続化し、再起動時に復元する。
保存場所: 原則として、ユーザー個別の設定ファイル（例: JSON形式、XML形式など）に保存する。保存場所はOSの標準的なアプリケーション設定ディレクトリ（例: Windowsなら %APPDATA%\アプリ名 ）を想定。
保存タイミング:
アプリケーション終了時。
設定変更が「適用」または「OK」された時。
初回起動時ガイダンスの「次回から表示しない」オプション変更時。
その他、リアルタイム性が求められるものは適宜。
復元タイミング: アプリケーション起動時。

2.2. 永続化する情報と詳細
2.2.1. フィルター条件の永続化
対象:
ブレ画像タブ: ブレスコア範囲（最小値、最大値）
類似画像タブ: 類似度範囲（最小値、最大値）
エラータブ: 選択されているエラーの種類
永続化の有無: する
保存単位: タブごとに最後に適用されたフィルター条件を記憶する。
復元方法: アプリ起動時、各タブに前回終了時のフィルター条件を復元し、UIに反映する。
リセット時の挙動: 「リセット」ボタン押下時は、フィルター条件を初期状態に戻すが、永続化された情報は変更しない（次回起動時はリセット前の状態が復元される）。「リセット」操作はセッション中のみ有効とし、永続化された値は変更しない。ユーザーが明示的にフィルターを適用した際に永続化する。

2.2.2. 選択フォルダの永続化
対象:
対象フォルダのパス
移動先フォルダのパス
永続化の有無: する
復元方法: アプリ起動時、ヘッダーの「対象フォルダ選択」「移動先フォルダ選択」エリアに前回指定したパスを復元・表示する。
注意点と対応: 復元時にパスが存在しない、またはアクセスできない場合は空欄にし、ユーザーに再度選択を促す。

2.2.3. ウィンドウの状態の永続化
対象:
ウィンドウのサイズ（幅、高さ）
ウィンドウの位置（X座標、Y座標）
ウィンドウの最大化状態
永続化の有無: する
復元方法: アプリ起動時、前回終了時のウィンドウサイズ、位置、最大化状態を復元する。
マルチディスプレイ環境の考慮: ユーザーがマルチディスプレイ環境で使用している場合、前回表示していたディスプレイに復元することを試みる。表示できない場合はプライマリディスプレイに表示するなどのフォールバック処理を行う。

2.2.4. メイン3ペインの幅の永続化
対象: 左ペイン、中央ペイン、右ペインのそれぞれの幅、またはペイン間の区切り線の位置。
永続化の有無: する
復元方法: アプリ起動時、前回ユーザーが調整した各ペインの幅を復元する。
ウィンドウリサイズ時の挙動との関連: ウィンドウサイズが変更された場合、ペイン幅の比率を維持するか、固定幅部分を優先するかなどを考慮する。

2.2.5. リストの表示状態の永続化
対象:
各タブ（ブレ画像、類似画像、エラー）のリストのソート状態（どのカラムで、昇順/降順か）
各タブのリストのスクロール位置
永続化の有無:
ソート状態: する 。ユーザーが最後に指定したソート順を記憶する。
スクロール位置: しない 。スキャン結果が変動する可能性があるため、永続化すると混乱を招く場合がある。（セッション中のみ記憶するかは実装時に判断）
復元方法 (ソート状態): アプリ起動後、スキャン結果が表示された際に、前回終了時のソート順でリストを並べ替える。永続化されたソート情報がない場合（例：初回起動時）は、各タブであらかじめ定義されたデフォルトのソート順（例：ブレ画像タブはブレスコア降順、類似画像タブは類似度降順、エラータブはファイル名昇順など）を適用する。

2.2.6. 設定画面で変更した設定値の永続化
対象:
スキャン設定: 「サブフォルダを常にスキャン対象に含める」のチェック状態
整理操作設定: 「『削除』ボタンのデフォルト動作」の選択状態
ログ設定: 「ログレベル」の選択状態、「ログファイルの場所」のパス
永続化の有無: する (設定画面の「適用」または「OK」ボタン押下時に保存)
復元方法: アプリ起動時に読み込み、アプリの動作および設定画面の表示に反映する。

2.2.7. 初回起動時ガイダンスの表示設定
対象: 「次回からこのガイダンスを表示しない」オプションの選択状態（例：hideGuidanceOnStartup: true/false）。
永続化の有無: する。
保存タイミング: ユーザーがガイダンス内で当該オプションのチェック状態を変更した上で、「開始する/閉じる」ボタンを押下した際、または「スキップ」ボタンを押下した際に保存する。
復元方法: アプリケーション起動時にこの設定値を読み込み、ガイダンスを表示するか否かの判断に使用する。

2.3. 永続化しない情報（セッション中のみ保持）
リストの選択状態: どのアイテムがチェックされているか。
現在のプレビュー対象: 左ペインに表示されている画像/情報。
スキャン中の進捗:
一時的なエラーメッセージや通知:

--- END OF FILE アプリケーション詳細設計書.txt ---